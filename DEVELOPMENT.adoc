// SPDX-FileCopyrightText: 2023 Digg - Agency for Digital Government
//
// SPDX-License-Identifier: CC0-1.0
= Development
:toc:
:revdate: {docdatetime}
:revnumber: 0.0.0
:imagesdir: assets

If you submit a Pull Request to this project, a few checks will be run on it with Continuous Integration.
Luckily, you can (as in, really should) run the checks locally to avoid surprises.

[[code-quality]]
== Code Quality Check

=== Run the checks locally

Run the code quality tooling check locally with the code-quality check script:

[source,shell]
----
$ ./development/code_quality.sh
----

The script is dependent on https://podman.io/[podman].

The resulting output should be pretty self explanatory.

===  What quality checks are done?

==== Linting

Tool: https://github.com/oxsecurity/megalinter[megalinter] (various linter tools)

Currently, the following checks are enabled:

- BASH scripts linting
- Markdown lint
- Yaml lint
- GitHub action lint
- Repository secrets with GitLeaks and Credentials scan

==== License Compliance

Tool: https://github.com/fsfe/reuse-tool[reuse] (license compliance check)

A license compliance check is run and controls that every file has valid copyright (in the SPDX-standard format).

==== Commit structure

Tool: https://github.com/siderolabs/conform[conform] (commit check)

The projects commit guides like standards if any are checked. (see CONTRIBUTING.adoc)

=== How to interpret the results

You will get a summary report at the end of the script run, telling you if something failed, or quality check passed.

_If the locally run script shows failing checks:_

You should be able to see the errors by scrolling through the output in your terminal.
Fix the errors, git add the fixes to your pr and re-run the script. Hopefully it shows all green the next round.

_If the CI Pipeline shows failing checks:_

You can repeat the errors found by the CI by running the code quality-script locally.
Fix the errors locally, and update the Pull Request when the local tests have passed.
The CI-tests should now show that you passed.

.Quality Check Output - CI Example
image::quality_ci_output_example.png[alt=Quality CI Example Output,width=640]

.Quality Check Output - Script Example
image::quality_script_output_example.png[alt=Quality Script OutPut Example,width=640]
